## 作业

作业是用户在一次算题过程中或一次事务处理中，要求计算机系统所做的工作的集合。

作业是比进程更广泛的概念，不仅包含了通常的程序和数据，而且还配有一份作业说明书，系统根据作业说明书对程序运行进行控制。在批处理系统中，以作业为单位从外存调入内存。

作业步是指每个作业运行期间都必须经过若干个相对独立，又相互关联的顺序加工的步骤。

每当作业进入系统时，系统便为每个作业建立一个作业控制块JCB，根据作业类型将它插入到相应的后备队列中。

## 进程

引入多道程序技术的前提条件之一是系统具有中断功能。

在多道程序环境下，允许多个程序并发执行，此时它们将失去其封闭性，并具有间断性及不可再现性的特征。为了更好地描述和控制程序的并发执行，实现操作系统的并发性和共享性，引入了进程的概念。

进程是资源分配和调度的基本单位。

进程的特征：动态性、并发性、独立性、异步性。

父进程与子进程共享一部分资源，但不共享虚拟地址空间。
父进程创建子进程和主程序调用子程序的区别：父进程创建子进程后，父进程与子进程同时执行。主程序调用子程序后，主程序暂停在调用点，子程序开始执行，直到子程序返回，主程序才继续运行。

由进程控制块、程序段、数据段构成了进程实体（又称进程映像）。进程映像是静态的，进程是动态的。进程和程序的根本区别是静态和动态特点。

#### 进程控制块

为了使参与并发执行的每个程序(含数据)都能独立地运行，在操作系统中必须为之配置一个专门的数据结构，称为进程控制块（Process Control Block，PCB）。

系统利用PCB来描述进程的基本情况和活动过程，进而控制和管理进程。

PCB主要包括进程描述信息、进程控制和管理信息、资源分配清单和处理机相关信息。

|  进程描述信息   | 进程控制和管理信息 | 资源分配清单 | 处理机相关信息 |
| :-------------: | :----------------: | :----------: | :------------: |
| 进程标识符(PID) |    进程当前状态    |  代码段指针  |  通用寄存器值  |
| 用户标识符(UID) |     进程优先级     |  数据段指针  |  地址寄存器值  |
|                 |  代码运行入口地址  |  堆栈段指针  |  控制寄存器值  |
|                 |   程序的外存地址   |  文件描述符  |  标志寄存器值  |
|                 |    进入内存时间    |     键盘     |     状态字     |
|                 |   处理机占用时间   |     鼠标     |                |
|                 |     信号量使用     |              |                |

系统是通过PCB感知进程存在的。PCB是进程存在的唯一标志。

进程控制块的组织形式有：1.线性方式；2.链接方式；3.索引方式

#### 程序段

#### 数据段

C语言编写的程序在使用内存时一般分为三个段，正文段、数据堆段、数据栈段。
二进制代码和常量（包括全局变量）放在正文段，动态分配的存储区放在数据堆段，临时使用的变量（包括局部变量、实参传递）放在数据栈段。

## 进程的状态与转换

1）创建状态。进程正在被创建，尚未转到就绪态。创建进程需要多个步骤：1.首先申请一个空白PCB，并向PCB中填写用于控制和管理进程的信息；2.然后为该进程分配运行时所必须的资源；3.最后把该进程转入就绪状态并插入就绪队列之中。但如果进程所需资源尚不能得到满足，则创建工作尚未完成，进程此时所处的状态称为创建状态。引起进程创建的主要事件有:用户登录、作业调度、请求或提供服务、应用请求（还有启动某种操作、新数据尚未到达、无新工作可做）

2）就绪（Ready）状态。此时进程已处于准备好运行的状态，即进程已分配到除CPU以外的所有必要资源。当一个进程被唤醒，意味着其进入就绪状态。

3）执行（Running）状态。此时进程已获得CPU，其程序正在执行的状态。

4）阻塞（Block）状态。又称等待状态、封锁状态。正在执行的进程由于发生某事件，如I/O请求、申请缓冲区失败等而暂停运行。此时会引起进程调度。

5）终止状态。进程需要结束运行时，需等待操作系统进行善后处理，最后将其PCB清零，并将PCB空间返还系统。

进程的五种基本状态及转换图：

<img src=".\pictures\进程的五种基本状态及转换.png" alt="进程的五种基本状态及转换" style="zoom:100%;" />



挂起原语（Suspend）和激活原语（Active）、活动就绪（Readya）和静止就绪（Readys）、活动阻塞（Blockeda）和静止阻塞（Blockeds）

被挂起的进程被安置在外存。

具有创建、终止和挂起状态的进程状态图：

<img src=".\pictures\具有创建、终止和挂起状态的进程状态图.png" alt="具有创建、终止和挂起状态的进程状态图" style="zoom:100%;" />

进程从运行状态变成阻塞状态以及进程挂起是主动的行为，而从阻塞状态变成就绪状态是被动的行为。

单处理器系统中有N个进程，处于执行状态的进程最多1个，最少0个；处于就绪状态的进程最多N-1个，最少0个；处于等待状态最多N个，最少N-1个。操作系统有N个进程，处于等待状态最多N个，最少0个。

## 进程的同步与互斥

#### 临界区

1）临界区：每个进程中访问临界资源的那段代码。

2）进入区：临界区前检查可否进入临界区的那段代码。

3）退出区：临界区后用于将正在访问临界区的标志清除的那段代码。

4）剩余区。代码的其余部分。

#### 同步机制

为禁止两个进程同时进入临界区，同步机制应遵循以下准则：

1）空闲让进。

2）忙则等待。

3）有限等待。对要求访问临界资源的进程，应保证在有限时间内能直接进入临界区，以免陷入"死等"状态

4）让权等待。当进程不能进入临界区时，应立即释放处理器，以免进程陷入"忙等"状态

前三个必须实现。

#### 硬件同步机制

1）关中断

2）TestAndSet 指令

3）Swap 指令

利用硬件指令能有效地实现进程互斥，但当临界资源忙碌时，其它访问进程必须不断地进行测试，处于一种"忙等"状态，不符合"让权等待"的原则，造成处理机时间的浪费，同时也很难将它们用于解决复杂的进程同步问题。

#### 信号量机制

信号量只能被两个标准的原语 wait(S) 和 signal(S) 访问，也可记为"P操作"和"V操作"。

1）整型信号量

2）记录型信号量

3）AND型信号量

4）信号量集

#### 管程

管程无须程序员自己实现互斥，可降低死锁的可能性。同时管程提供了条件变量，可以让程序员灵活地实现进程同步。

管程由四部分组成：1）管程的名称。2）局部于管程内部的共享数据结构说明。3）对该数据结构进行操作的一组过程或函数。4）对局部于管程内部的共享数据设置初始值的语句。

x.wait：当x对应的条件不满足时，正在调用管程的进程调用 x.wait 将自己插入 x 条件的等待队列，并释放管程。注意：调用 x.wait 时，说明已无相应资源可用，直接将进程放入阻塞队列。

## 进程的通信

1.共享存储器系统

操作系统只负责为通信进程提供可共享使用的存储存储空间和同步互斥工具。访问控制由进程负责，而不是OS。

1）基于共享数据结构的通信方式

低级

2）基于共享存储区的通信方式

高级

2.管道通信系统

所谓"管道"，是指用于连接一个读进程和一个写进程以实现它们之间通信的一个共享文件，又名 pipe 文件。pipe 文件在内存中。

高级

3.消息传递系统

高级

## 线程

调度和分派的基本单位。线程的调度由操作系统完成。

进程中的线程共享进程内的全部资源，但进程中某线程的栈指针对其它线程是透明的。

<img src=".\pictures\多线程模型.png" alt="多线程模型" style="zoom:80%;" />

1)多对一模型。将用户线程映射到一个内核控制线程，操作系统内核只能感知到一个调度单位的存在。优点：线程管理的开销小，效率高。缺点：如果一个线程在访问内核时发生阻塞，则整个进程都会阻塞。

2）一对一模型。将每一个用户线程映射到一个内核控制线程。缺点：开销较大。

3）多对多模型。

注意：仅一对一模型，操作系统为每个用户级线程建立一个线程控制块。