### 流量控制

在计算机网络发展前期，通信链路的质量不是很好，所以链路层就要担负起可靠传输的职责，因此链路层就会使用停止-等待协议、GBN、SR等等。随着技术的发展，通信链路的质量越来越好，出现差错的可能性越小，链路层不再担负可靠传输的职责，可靠性由传输层实现，链路层此时主要负责差错控制，减少了职责，速度变快、延迟变小

在链路层上，接收方没有接收数据是不会发送确认帧给发送方

自动重传请求(Automatic Repeat reQuest，ARQ)通过接收方请求发送方重传出错的数据帧来恢复出错的帧，是通信中用于处理信道所带来差错的方法之一。传统自动重传请求分为三种，即停止-等待ARQ、后退N帧ARQ和选择重传ARQ。

（一）停止-等待协议（Stop-and-Wait）

​	发送窗口与接收窗口大小均为1

​	一帧一帧发送，一帧一帧接收并确认

​	信道利用率低

（二）多帧滑动窗口

​	帧编号序号是以二进制形式，序号长度是指比特的位数。

​	同时，窗口总大小（包括发送窗口与接收窗口之和）最大必须≤2<sup>长度</sup>

1. 后退N帧协议（Go-Back-N，GBN）

   发送窗口大小>1，接收窗口大小=1

   GBN发送方必须响应的三件事：1)上传的调用。上层要发送数据时，发送方先检查发送窗口是否已满，如果未满，则产生一个帧并将其发送；如果窗口已满，发送方只需将数据返回给上层，暗示上层窗口已满。上层等一会儿再发送。2）收到一个ACK。GBN协议中，接收方对n号帧的确认采用累积确认的方式。缺点是会造成批量重传。3）超时事件。

   发送(或接收)窗口大小n与帧的序号长度关系应满足：n≤2<sup>长度</sup>-1

   帧的确认不是一帧一帧的确认

2. 选择重传协议（Selective Repeat，SR）

   SR发送方必须响应的三件事：1)上传的调用。从上层收到数据后，SR发送方检查下一个可用于该帧的序号，如果序号位于发送窗口内，则发送数据帧；否则就像GBN一眼，要么将数据丢弃，要么返回给上层，等一会儿再传输。2）收到一个ACK。如果收到一个ACK，则加入该帧序号在窗口内，并且SR发送方将那个被确认的帧标记为已接收。如果该帧序号是窗口的下界，则窗口向前移动到具有最小序号的未确认帧处。如果窗口移动了并且有序号在窗口内的未发送帧，则发送这些帧。3）超时事件。每个帧都有自己的定时器，一个超时事件发生后只重传一个帧

   SR接收方将确认一个正确接收的帧而不管其是否按序。失序的帧将被缓存，并返回给发送方一个该帧的确认帧，知道所有帧（即序号更小的帧）皆被接收到为止，这时接收方才可以将一批帧按序交付给上层，然后向前移动滑动窗口。

   帧是一帧一帧的确认

   最大发送窗口W<sub>S</sub>和最大接收窗口W<sub>R</sub>与帧的序号长度关系应满足：W<sub>S</sub>=W<sub>R</sub>=2<sup>序列号-1</sup>

$$
\begin{aligned}
&信道利用率=\frac{传输帧的有效时间}{周期}=\frac{\frac{L}{C}}{ T} \\
&L:一个周期时间内发送的数据比特数\\
&C:发送方的信道传数速率\\
&T:发送周期=帧在发送端的传输时延+帧从发送端到接收端的传播时延+\\
&\hspace{0.75cm}确认帧在接收端的传输时延+确认帧从接收端到发送端的单程传播时延\\
&如果题中表述为一个信道的传输速率，则传输时延只计算发送端的不计算接收端的
\end{aligned}
$$

信道吞吐率=信道利用率*发送方的发送速率

对于窗口大小为n的滑动窗口，最多有n-1帧已发送。注意：窗口和发送窗口不是同一个意思。可理解为每个窗口依次编号0、1、⋯、n，而发送窗口，只是其中的能把帧发送出去的窗口。如果发送窗口大小为n，则下次发送的第一个帧时，是无法区分旧帧与新帧的。