## 网络应用模型

#### 客户/服务器模型

<img src=".\picture\CS模型.png" alt="CS模型" style="zoom:80%;" />



客户机是面向用户的，服务器是面向任务的。

网络中各计算机的地位不平等，服务器可以通过对用户权限的限制来达到管理客户机的目的，使它们不能随意存储/删除数据，或进行其他首先的完了过活动。整个网络的管理工作有少数服务器担当，因此网络的管理非常集中。

客户机相互之间不直接通信。

可扩展性不佳。手服务器硬件和网络宽带的限制，服务器支持的客户机数有限。

#### P2P模型

<img src=".\picture\P2P模型.png" alt="P2P模型" style="zoom:70%;" />

P2P网络是指互联网中有对等结点组成的一种覆盖网络，是一种动态的**逻辑**网络

P2P模型的思想是整个网络中的传输内容不再保存在中心服务器上，每个结点都同时具有下载、上传的功能，其权利和义务都是大体对等的。

对等方间歇连接并且可以改变IP地址

优点：

* 自扩展性，传统服务器有响应和宽带的限制，因此只能接受一定数量的请求
* 网络健壮性，单个结点的失效不会影响其他部分的结点

缺点：在获取服务的同时，还要给其他结点提供服务，因此会占用较多的内存，影响整机速度。

具有P2P体系结构的应用程序既有客户进程又有服务器进程

## 域名系统

域名系统（Domain Name System，DNS）是因特网使用的命名系统，用来把便于人们记忆的具有特定含义的主机名转换为便于机器处理的IP地址。

DNS是一个分布式、层次数据库。

DNS系统采用客户/服务器模型，其协议运行在**UDP**之上，使用**53**号端口。

域名中的标号：

* 标号中的英文不区分大小写
* 标号中除连字符(-)外不能使用其他的标点符号
* 每个标号不能超过63各字符，多标号组成的完整域名最长不能超过255个字符

注意：域名与IP地址、MAC地址或主机都不存在一一对应的关系

#### 域名服务器

1）根域名服务器

因特网上有13个根域名服务器

根域名服务器用来管辖顶级域，通常它并不直接把待查询的域名直接转换称IP地址，而是告诉本地域名服务器下一辈应当找那个顶级域名服务器进行查询

2）顶级域名服务器

顶级域名服务器负责管理在该顶级域名服务器注册的所有二级域名。

3）授权域名服务器（权限域名服务器）

每台主机都必须在授权域名服务器处登记。授权域名服务器总能将其管辖的主机名转换为该主机的IP地址。

实际上，为了更加可靠地工作，一个主机最好有至少两个授权域名服务器。

许多域名服务器同时充当本地域名服务器和权威域名服务器。

4）本地域名服务器（默认域名服务器）

严格来说不属于该服务器的层次结构。

当一个主机发出DNS查询报文时，这个报文就首先被送往该主机的本地域名服务器

* 起着代理的作用，转发请求到层次结构中

#### 域名解析过程

不常用方式：

<img src="C:\Users\Administrator\Desktop\_posts\课程学习\计网\picture\递归查询.png" alt="递归查询" style="zoom:80%;" />

实际中常用递归与迭代相结合的查询方式：

<img src="C:\Users\Administrator\Desktop\_posts\课程学习\计网\picture\递归与迭代查询相结合.png" alt="递归与迭代查询相结合" style="zoom:80%;" />

主机向本地域名服务器的查询采用的是递归查询，本地域名服务器向根域名服务器的查询采用的是迭代查询。

对y.abc.com域名解析的过程（共使用了8个UDP报文）：

* 客户机向其本地域名服务器发出DNS请求报文（递归查询）
* 本地域名服务器收到请求后，查询本地缓存，若没有该记录，则以DNS客户的身份向根域名服务器发出解析请求报文（迭代查询）
* 根域名服务器收到请求后，判断该域名属于.com域，将对应的顶级域名服务器 dns.com的IP地址返回该本地域名服务器
* 本地域名服务器向顶级域名服务器dns.com发起解析请求报文（迭代查询）
* 顶级域名服务器dns.com收到请求后，判断该域名属于abc.com域，将对应的授权域名服务器dns.abc.com的IP地址返回给本地域名服务器
* 本地域名服务器向授权域名服务器dns.abc.com发起解析请求报文（迭代查询）
* 授权域名服务器dms.abc.com收到请求后，将查询结果返回给本地域名服务器
* 本地域名服务器将查询结果保存到本地缓存，同时返回给客户机

## 文件传输协议

 文件传输协议（File Transfer Protocol，FTP）是因特网上使用最广泛的文件传输协议。

FTP采用客户/服务器模型，其协议运行在**TCP**之上，控制连接在**21**端口

1）控制连接

服务器监听21号端口，等待客户连接，建立在这个端口上的连接称为控制连接。

由于FTP传输控制信息使用的是数据连接外的控制连接，所以也称FTP的控制信息是带外传送的。

2）数据连接

数据连接有两种传输模式：

* 主动模式PORT

  客户端连接到服务器的21号端口，登录成功后要读取数据时，客户端随机开放一个端口，并发送PORT命令告知服务器，服务器收到命令和端口号后，通过20端口和客户端开发的端口连接，发送数据。

  传输数据是服务器连接到客户端的端口

* 被动模式PASV

  客户端要读取数据时，发送PASV命令到服务器，服务器在本地随机开放一个端口并告知客户端，客户端在连接到服务器开放的端口进行数据传输。

  传输数据是客户端连接到服务器的端口

FTP使用两个独立连接的原因：可使FTP更加简单、更容易实现、更有效率，同时在文件传输过程中，还可以利用控制连接控制传输过程。

FTP的服务器进程由两大部分组成：一个是主进程，负载接受新的请求；若干从属进程，负责处理单个请求

FTP功能：

* 提供不同种类主机系统之间的文件传输能力

* 以用户权限管理的方式提供用户对远程FTP服务器上的文件管理能力

* 以匿名FTP的方式提供公用文件共享的能力

  匿名FTP访问通常使用 anonymous 作为用户名

FTP不适合用在两个计算机之间共享读写文件

主要工作过程：在进行文件传输时，FTP客户所发出的传送请求通过控制连接发送给服务器端的控制进程，并在整个会话期间一直保持打开，但控制连接不用来传送文件。服务器端的控制进程在接收到FTP客户发送来的文件传输请求后，就创建数据传送进程和数据连接，数据连接用来连接客户端和服务器端的数据传输进程，数据传送进程实际完成对文件的传送，在传送完毕后关闭"数据传送连接"，并结束运行。

## 电子邮件

电子邮件是一种异步通信方式，通信时不需要双方同时在场。

电子邮件系统的三个最主要的组成构件：

* 用户代理（User Agent，UA）

  用户代理向用户提供一个接口，用来发送和接受邮件。通常情况下，用户代理就是一个运行在PC上的程序（电子邮件客户端软件）

* 邮件服务器

  邮件服务器的功能时发送和接受邮件，同时还要向发信人报告邮件传送的情况。

  邮件服务器采用客户/服务器方式工作，但它必须能够同时充当客户和服务器。

* 电子邮件使用的协议

  邮件发送协议用于用户代理向邮件服务器发送邮件或在邮件服务器之间发送邮件，如SMTP

  邮件读取协议用于用户代理从邮件服务器读取邮件，如POP3、IMAP

邮件收发过程：发信人调用用户代理来撰写和编辑要发送的邮件。用户代理用SMTP把邮件**发送**给发送端邮件服务器。发送端邮件服务器将邮件放入邮件缓存队列中，等待发送。运行在发送端邮件服务器的SMTP客户进程，发现邮件缓存中有待发送的邮件，就向运行在接收端邮件服务器的SMTP服务器进程发起TCP连接。TCP连接建立后，SMTP客户进程开始向远程SMTP服务器进程**发送**邮件。当所有待发送邮件发完后，SMTP就关闭所建立的TCP连接。收信人打算收信时，调用用户代理使用POP3或IMAP协议将自己的邮件从接收邮件服务器的用户邮箱中**拉取**。

#### 简单邮件传输协议

简单邮件传输协议（Simple Mail Transfer Protocol，SMTP）是一种提供可靠且有效的电子邮件传输的协议。

SMTP使用客户/服务器方式，其协议运行在**TCP**之上，使用**25**号端口。

SMTP只支持传输7比特ASCII码内容，且无法传送可执行文件及其他二进制对象。

用户浏览器（如Firefox）与邮件服务器（如Hotmail或Gmail）之间的邮件发送或接收使用的是HTTP，而仅在不同邮件服务器之间传送邮件时才使用SMTP。

#### 多用途因特网邮件扩展

多用途因特网邮件扩展（Multipurpose Internet mail Extensions，MIME）并未改动SMTP或取代它。定义了传送非ASCII码的编码标准。

#### 邮局协议

邮局协议（Post Office Protocol，POP）是一个非常简单但功能有限的邮件读取协议，现在使用的是它的第三版本POP3。

POP使用客户/服务器方式，其协议运行在**TCP**之上，使用**110**号端口。

POP3协议在传送层是使用明文来传输密码的，并不对密码进行加密。

#### 因特网报文存取协议

因特网报文存取协议（IMAP）

#### 电子邮件格式

一个电子邮件分为信封和内容两大部分，邮件内容又分为首部和主题两部分。

## 万维网

万维网（World Wide Web，WWW）是一个分布式、联机式的信息存储空间。万维网是无数个网络站点和网页的集合，它们在一起构成的因特网最主要的部分。

万维网的内核由三个标准构成：

* 统一资源定位符（URL）
* 超文本传输协议（HTTP）
* 超文本标记语言（HTML）

#### 超文本传输协议

超文本传输协议（HyperText Transfer Protocol，HTTP）是面向事务的应用层协议，它规定了在浏览器和服务器之间的请求和响应的格式与规则，是万维网上能够可靠地交换文件的重要基础。

HTTP使用TCP作为运输层协议

HTTP本身是无连接的，虽然HTTP使用了TCP连接，但通信双方在交换HTTP报文之前不需要先建立HTTP连接

HTTP是无状态的，无状态特性简化了服务器的设计，使服务器更容易支持大量并发的HTTP请求。

HTTP/1.1支持使用持久连接

对于非持久连接，每个网页对象（如JPEG图形）的传输都需要单独建立一个TCP连接，每个对象引用都导致2×RTT的开销（一个用于TCP连接，另一个RTT用于请求和接收文档），此外每次建立新的TCP连接都要分配缓存和变量，是万维网的负担变重

所谓持久连接是指万维网服务器在发送响应后仍然保持这条连接，是同一个客户（浏览器）和该服务器可以继续在这条连接上传送后续的HTTP请求和响应报文。

持久连接又分为非流水线和流水线方式。对于非流水线方式，客户在收到前一个响应后才能发出下一个请求，每个引用对象经历1个RTT延迟，服务器发送完一个对象后，其TCP连接就处于空闲状态，浪费了服务器资源。HTTP/1.1默认使用流水线方式，此时客户每遇到一个对象引用就立即发出一个请求，所有引用对象共计经历一个RTT延迟。

| 状态码 |                      状态描述说明                      |
| :----: | :----------------------------------------------------: |
|  200   |            请求成功，信息在返回的响应报文中            |
|  400   |           请求有语法错误，不能被服务器所理解           |
|  401   |                      请求未经授权                      |
|  403   |            服务器收到了请求，但拒绝提供服务            |
|  404   |                     请求资源不存在                     |
|  405   |                    请求的方法不允许                    |
|  500   |                服务器发生不可预期的错误                |
|  503   | 服务器当前不能处理客户端的请求，一段时间后可能回复正常 |
