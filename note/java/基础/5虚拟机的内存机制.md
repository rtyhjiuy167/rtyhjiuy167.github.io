---
title: 5 虚拟机的内存机制
top: 5
tags:
  - Java
categories:
  - Java
---

```java
/**
 * 虚拟机(JVM,Java Virtual Machine)
 *  指通过软件模拟的具有完整硬件系统功能的、运行在一个完全隔离环境中的完整计算机系统。
 * Java虚拟机对字节码进行解释生成对于平台的机器码并执行。
 * Java虚拟机是Java跨平台的重要原因
 *
 * Java虚拟机在执行Java程序的过程中会把它所管理的内存划分为若干个不同的数据区域。
 *  主要包括方法区、堆区、虚拟机栈、本地方法栈、程序计算器，
 *      其中方法区和堆区为进程的所有子线程共享，其它的为线程独有
 */

/*
|---------------------------|
|         运行时数据区         |
|---------------------------|
| 方法区 | 虚拟机栈 | 本地方法栈 |
|---------------------------|
|     堆     |  程序计算器     |
-----------------------------|
    ↑   ↓        ↑   ↓
    执行引擎  →  本地库接口 → 本地方法库
 */

/**
 * 程序计算器
 *   程序计算器是一块较小的内存空间，它的作用可以作是当前线程所执行的字节码的行号指示器。
 *   每个线程都有一个独立的程序计数器，各条线程之间的计数器互不影响，独立存储，是线程私有内存
 *
 *  虚拟机栈和本地方法栈
 *      每个线程开辟一个栈内存，本地方法栈为虚拟机使用的Native方法服务（调用其它语言来实现）
 *
 *  Java 堆
 *      垃圾过收集管理的主要区域
 *
 *  方法区
 *      方法区和 java 堆一样，是各线程共享的内存区域，它用于存储已被虚拟机加载的类信息，常量，静态变量。
 */

/*
JVM堆内存划分（JDK1.8及之后）
     新生代：
        Eden(伊甸园),
        存活区：
            Survivor(From Space 简称S0),Spaces(To Space 简称S1)
        Virtual(伸缩区)
     老年代：
        Tenured(旧生代)
        Virtual(伸缩区)
     元空间（方法区）：
        MetaSpace(元空间)
        Virtual(伸缩区)
        
  元空间是方法区的一种具体实现。
  元空间使用的是本地内存。

//每移动一次 年龄加一 十五时，进入 老年代
      Eden → S0
      S0 → S1
      S0 ← S1
  新生代 扫描时间间隔短
  老年代 里的内存不够了，就扫描一次，移除垃圾 全量回收
 */


/*
程序员可以通过 System.gc() 或者 Runtime.getRuntime().gc()来通知系统进行垃圾回收
    但是系统是否进行垃圾回收仍不确定
垃圾回收机制回收任何对象之前，总会调用它的 finalize 方法(JDK9已弃用)
    该方法不要自己主动调用，应交给垃圾回收机制来调用
 */

```

