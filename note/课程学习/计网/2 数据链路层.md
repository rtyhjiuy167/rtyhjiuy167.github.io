### 数据链路层的功能

（一）帧定界、帧同步、透明传输

​	帧的首部和尾部含有很多控制信息，它们的一个重要作用是确定帧的界限，即帧定界。

​	数据中恰好出现与帧定界符相同的比特组合会误认为“传输结束”而丢弃后面的数据，所以需要透明传输。

（二）差错控制

​	通常采用循环冗余(CRC)方式发现位错，通过自动重传(Automatic Repeat reQuest，ARQ)方式来重传出错的帧

​	帧错指帧的丢失、重复或失序等错误。引入定时器和编号机制来解决帧错

（三）流量控制

​	在OSI体系结构中，数据链路层具有流量控制的功能。而在TCP/IP体系结构中，流量控制功能被移到了传输层。

​	流量控制实际上是限制发送方的数据流量，是其发送速率不超过接收方的接收能力

### 数据链路层协议

点对点协议（Point to Point Protocol，PPP）

串行线路网际协议（Serial Line IP，SLIP）

### 差错

传输中的差错都是由于噪声引起的。

全局性：由于线路本身电气特性所产生的随机噪声(热噪声)，是信道固有的，随机存在的。

解决方法：提高信噪比来减少或避免干扰。（对传感器下手）

局部性：外界特定的短暂原因所造成的冲击噪声，是产生差错的主要原因

解决方法：通常利用编码技术来解决

数据链路层编码和物理层的数据编码与调制不同。物理层编码针对的是**单个比特**，解决传输过程中比特的同步等问题，如曼彻斯特编码。而数据链路层的编码针对的是**一组比特**，它通过冗余码的技术实现一组二进制比特串在传输过程是否出现了差错。

#### 检错编码

1. 奇偶校验码

   只能检测奇数个比特错误

2. 循环冗余码（Cyclic Redundancy Code，CRC）

   CRC又称多项式码。CRC是具有纠错功能的，只是数据链路层仅使用了它的检错功能，检错到帧出错则直接丢弃，这是为了方便协议的实现。使用CRC没有实现“可靠传输“（可靠传输是发送端发送什么，接收端就受到什么，要求接收端实现纠错功能）。链路层是实现了纠错功能的，采用的是海明码

```
例：要发送的数据是1101 0110 11，采用CRC校验，生成多项式是10011，那么最终发送的数据应该是？
解：
	1）10011表示成多项式为 1*X^4+0*X^3+0*X^2+X^1+1*X^0=X^4+X^1+1，阶为4，故最终发送的数据位数比原数据位数多4位，这4位为帧检验序列FCS,
	2）多4位，先再原数据最右边补4个0，变为 1101 0110 1100 00
	3）以从左到右的顺序取生成多项式位数的数据，即 11010，用 11010 与 10011 进行异或操作（同0异1）操作，结果为 01001，舍弃左边所有的0直至1为止，即 1001，接着用原数据的右边几位补齐多项式的位数，即 10010，再与 10011 进行异或操作，依次循环进行，直至剩下的数据为 4 位，即 1110，该4位即位FCS
```

### 纠错编码

海明码

两个合法编码(也叫码字，例如010、000等)的对应比特值不同的比特数称为这两个码字的海明距离（也叫码距）。例如010与000，仅有一位不同，所以这两个码字的海明距离为1。如果在一个有效编码集中，任意两个合法编码的海明距离的最小值称为该编码集的海明距离（码距）。

检错能力n位时，码距应为n+1；纠错能力n位时，码距应为2n+1。举例：对于码距为5的有效编码集，可以这样想，把一个有效码字通过位错变为另一有效码字，一共需要5位，此时可滥竽充数的。如果少出错一位，即只出错四位是变不成另一个有效码字，所以，检错能力为4。任意两个有效编码，想往同一个无效编码上去靠拢时，两个编码上总共需要出错5位，如果保证每个有效编码最多只出错两位，而不论出错哪两位，出错后的编码是唯一的，无法达到同一无效编码，当每个出错3位才会达到，所以纠错能力是两位

对于m位的原数据，在原数据后加上r位校验码，r应满足2<sup>r</sup>≥m+r+1，m+r表示每个位发生错误，每个位都错了，那就不能表示该数据错了1表示没有发生错误

校验码放在2<sup>n</sup>位上，例如原始数据1100

| 二进制 | 111  | 110  | 101  |      100      | 011  |      010      |      001      |
| :----: | :--: | :--: | :--: | :-----------: | :--: | :-----------: | :-----------: |
|  序号  |  7   |  6   |  5   |       4       |  3   |       2       |       1       |
|   值   |  1   |  1   |  0   | x<sub>4</sub> |  0   | x<sub>2</sub> | x<sub>1</sub> |

x<sub>1</sub>负责校验二进制为\*\*1形式的值，即序号为1、3、5、7；x<sub>2</sub>负责校验二进制为\*\*1形式的值，即2、3、6、7；x<sub>4</sub>负责校验二进制为\*\*1形式的值，即4、5、6、7。使用偶校验，则x<sub>1</sub>=1，x<sub>2</sub>=0，x<sub>4</sub>=0

如果发送已附上海明校验码的数据，1100001，若接收方收到的却是1110001，如何纠错？

x<sub>4</sub>=0，x<sub>2</sub>=0，x<sub>1</sub>=1，将每个校验码与其负责序号的二进制值进行异或操作，结果各为101(x<sub>4</sub>、x<sub>2</sub>、x<sub>1</sub>)，二进制101对应序号5，即序号为5的值出错了

传输数据使用的两种链路：1.点对点链路。常用于广域网。2.广播式链路。常用于局域网。

### 介质访问控制

#### 静态划分信道

信道划分介质访问控制协议（Multiple Access Control）

多路复用器的主要功能是结合来自两条或多条线路的传输，以充分利用信道

1.频分多路复用 FDM

​	适用于传输模拟信号

2.时分多路复用 TDM

​	TDM与FDM相比，抗干扰能力强，可以逐级再生整形，避免干扰的积累，而且数字信号比较容易实现自动转换。

​	适用于传输数字信号

​	统计时分复用

3.波分多路复用 WDM

4.码分多路复用 CDM

令向量S表示A站的码片向量，令T表示B站的码片向量。两个不同站的码片序列正交，即向量S和T的规格化内积为0
$$
\begin{aligned}
&站点A、B、C通过CDMA共享链路，A、B、C的码片序列分别是(1,1,1,1)、(1,-1,1,-1)和(1,1,-1,-1)。\\
&若C从链路上收到的序列是(2,0,2,0,0,-2,0,-2,0,2,0,2)，则C收到A发送的数据是?\\
解：&把收到额序列分成每4个数字一组，即(2,0,2,0)、(0,-2,0,-2)、(0,2,0,2)\\
&把这三组数据与A站的脉案序列(1,1,1,1)做规格化内积运算，结果分别为\\
&(2,0,2,0)⋅(1,1,1,1)/4=1、(0,-2,0,-2)⋅(1,1,1,1)/4=-1、(0,2,0,2)⋅(1,1,1,1)/4=1，即101
\end{aligned}
$$


#### 动态划分信道

##### 轮询访问介质访问控制

令牌传递协议

令牌是指一种特殊的控制帧

常用于网络负载较重、通信量较大的网络中

令牌环网中，在同一时刻，环上只有一个数据在传输；数据从一个结点到另一个结点的时间可以计算；网上所有结点共享网络带宽

##### 随机访问介质访问控制

所有用户可随机发送信息。发送信息时占全部带宽

（一）ALOHA协议

 1. 纯ALOHA协议

    想发就发

    利用率最大为 0.184

 2. 时隙ALOHA协议

    把时间分成若干相同的时间片，所有用户在时间片开始时刻同步接入网络信道，若发生冲突，则必须等到下一个时间片开始时刻再发送

（二）CSMA协议（carrier sense multiple access）

​	CS：载波侦听/监听，每一个站在发送数据之前要检测一下总线上是否有其他计算机在发送数据（注意：监听只能检测站所在点有没有其他数据源，不能直接检测到其他地方是否有数据在发送，只是还没到这儿）

​	检测原理：当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大（互相叠加）。当一个站检测到的电压摆动值超过一定阈值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞，即发生了冲突

​	MA：多点接入，表示许多计算机以多点接入的方式连接在一根总线上

1. 1-坚持CSMA
1. 非坚持CSMA

​	如果一个主机要发送消息，那么先监听信道
​	空闲则之间传输，不必等待
​	忙则等待一个随机时间之后再进行监听

​	优点：降低了多个结点等待信道空闲后同时发送数据导致冲突的概率，提高了信道利用率
​	缺点：可能存在所有结点都在延迟等待的过程，增加了数据在网络中的平均延迟

​	3. p-坚持CSMA

​	如果一个主机要发送消息，那么先监听信道
​	空闲则以p概率直接传输，不必等待；概率1-p等待到下一个时间槽再传输
​	忙则持续监听直到信道空闲再以p概率发送
​	若冲突则等到下一个时间槽开始再监听并重复上诉过程

​	优点：既能像非坚持那样减少冲突，又能像1-坚持算法那样减少媒体空闲时间

（三）CSMA/CD协议（carrier sense multiple access with collision detection）

​	CS：载波侦听/监听，每一个站在发送数据之前以及**发送数据时**要检测一下总线上是否有其他计算机在发送数据

​	CD：碰撞检测（冲突检测），适配器（可理解为发送数据的主机、源站点）边发送数据边检测信道上信号电压的变化情况，以便判断自己发送数据时其他站是否也在发送数据

​	冲突时，采用二进制指数退避算法来确定推迟时间

​	半双工网络。如果同时发送与接收，必然会导致冲突

​	冲突检测时间（即争议(用)期）：信号在最远两个端点之间往返传输的时间

​	为保证帧刚发出就有接收到其他站的数据，即检测到冲突，规定最小帧长=总线的传播时延x数据传输速率x2

​	以太网络规定，最小帧长为64字节 有线

（四）CSMA/CA协议（carrier sense multiple access with collision avoidance)

​	仅在发送数据之前检测信道是否空闲

1. RTS/CTS（可选，用于处理隐蔽站问题）

​		发送数据前，先检测信道是否空闲
​		空闲则发出RTS（request to send），RTS包括发送端、接收端的地址、下一份数据将持续发送的时间等信息；信道忙则等待
​		接收端收到RTS后，将响应CTS（clear to send）
​		发送端收到CTS后，开始发送数据帧

2. 预约信道

   进行信道预约的方法是交换 RTS 与 CTS 帧

​	发送方告知其他站点自己要传多久数据

3. ACK帧

​	接收端收到数据帧后，将用循环冗余检验（CRC）来检验数据是否正确，正确则响应ACK帧

​	发送方收到ACK就可以进行下一个数据帧的发送，若在一定时间内没有收到则一直重传至规定次数为止（采用二进制指数退避算法来确定推迟时间）

​	用于无线局域网

CSMA/CD与CSMA/CA协议

相同点：CSMA/CD与CSMA/CA机制都从属于 CSMA的思路，其核心是先听后说。即，两个在接入信道之前都需要进行监听。当发现信道空闲后，才能接入。

不同点：
1.传输介质不同：CSMA/CD用于总线式以太网，有线；而CSMA/CA用于无线局域网
2.载波检测方式不同：因传输介质不同，CSMA/CD与CSMA/CA的检测方式也不同。CSMA/CD通过电缆中电压的变化来检测，当数据发生碰撞时，电缆中的电压就会随着发生变化；而CSMA/CA采用能量检测（ED）、载波检测（CS）和能量载波混合检测三种检测信道空闲的方式。
3.CSMA/CD检测冲突，CSMA/CA避免冲突



负载：每个时隙的发送次数
