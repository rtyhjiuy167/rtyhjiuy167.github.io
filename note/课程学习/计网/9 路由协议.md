

## 路由协议

### 自治系统

自治系统（Autonomous System，AS）：单一技术管理下的一组路由器，这些路由器使用一种AS内部的路由选择协议和共同的度量来确定分组在该AS内的路由，同时还使用一种AS之间的路由选择协议来确定分组在AS之间的路由。

一个自治系统内的所有网络都由一个行政单位管辖，一个自治系统的所有罗尤其在本自治系统内都必须是联通的。

<img src=".\picture\区域.png" alt="区域" style="zoom:67%;" />

两个自治系统相邻的区域为主干区域。图中，R3既是主干路由器又是区域边界路由器。R6既是主干区域路由器，又是自治系统边界路由器。

自治系统划分区域的好处是，将利用洪泛法交换链路状态信息的范围局限在每个区域内，而不是整个自治系统

### 域内路由与域间路由

内部网关协议，即域内路由协议（Interior Gateway Protocol，IGP）包括 RIP、OSPF
外部网关协议（External Gateway Protocol，EGP），即域间路由协议

|   协议   |                    RIP                    |                 OFPG                 |         BGP          |
| :------: | :---------------------------------------: | :----------------------------------: | :------------------: |
|   类型   |                   内部                    |                 内部                 |         外部         |
| 路由算法 |                 距离-向量                 |               链路状态               |      路径-向量       |
| 传递协议 |                    UDP                    |                  IP                  |         TCP          |
| 路径选择 |                 条数最少                  |               代价最低               |     较好,非最佳      |
| 交换结点 |           和本结点相邻的路由器            |          网络中的所有路由器          | 和本结点相邻的路由器 |
| 交换内容 | 当前本路由器知道的全部信息,即自己的路由表 | 与本路由器相邻的所有路由器的链路状态 |                      |

#### RIP协议

路由信息协议（Routing Information Protocol，RIP）协议是应用层协议,使用UDP传送数据。

RIP协议是一种分布式的基于距离向量的路由选择协议，是因特网的协议标准，最大优点是简单。

分散性，路由器只掌握物理项链的邻居及链路费用。

RIP协议要求网络中每一个路由器都维护从它自己到其他每一个目的网络的唯一最佳距离记录（即一组距离）。

RIP协议允许一条路由最多只能包含**15**个路由器，因此跳数为16表示网络不可达。RIP协议只使用于小互联网

RIP规定，路由器仅和相邻路由器交换信息，即自己的路由表。每30秒交换一次路由信息（交换的信息最多不能超过30条），然后路由器根据信息更新路由表。若超过180s没收到邻居路由器的通告，则判定邻居没了，并更新自己的路由表。

路由器刚开始工作时，只知道直接连接的网络的距离（距离为1），接着每一个路由器也知和数目非常有限的相邻路由器交换并更新路由信息。经过若干次更新后，所有路由器最终都会知道到达本自治系统任何一个网络的最短距离和下一跳路由器的地址，即“收敛”

慢收敛：当路由信息发生变化时，该变化未能及时地被所有路由器知道，而仍然可能在路由器之间进行传递。

慢收敛是导致发生路由回路的根本原因。好消息传得快，坏消息传得慢。

路由表更新规则：
1）如果目的网络相同，且下一跳路由器相同，直接更新；2）如果是新的目的网络地址，那么增加表项；3）若目的网络相同，且下一跳路由器不同，且距离更短，则更新；4）否则，无操作

#### OSPF协议

开放最短路径优先（OSPF）协议是使用分布式链路状态路由算法的典型代表，也是内部网关协议的一种。

OFPF与RIP的区别：

* OSPF使用洪泛法向本自治系统中的所有路由器发送信息。而 RIP仅向自己相邻的几个路由器发送信息
* 发送的信息是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息（OSPF协议不传送整个路由表，而传送受影响的路由更新报文）。而在RIP中，发送的信息是本路由器所知道的全部信息，即整个路由表
* 只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息，并且更新过程收敛快，不会出现RIP"坏消息传得慢"的问题。而在RIP中，不管网络拓扑是否发生变化，路由器都会定期交换路由表信息。
* OSPF是网络层协议，它不使用UDP或TCP，而直接用IP数据报传送，其IP数据报首部的协议字段为89。而RIP是应用层协议，它在传输层使用UDP.

OSPF协议维护一张它所连接的所有链路状态信息的邻居表和拓扑数据库，使用组播链路状态更新（Link State Update，LSU）报文实现路由更新，并且只有当网络已经发生变化时才传送 LSU 报文。

OSPF共有5种分组类型：
1）问候（Hello）分组：用来发现和维持邻站的连接
2）数据库描述（DD）分组
3）链路状态请求（LSR）分组
4）链路状态更新（LSU）分组
5）链路状态确认（LSAck）分组

全局性

全网路由器的拓扑数据库是一致的

#### 边界网关协议

边界网关协议（BGP）是应用层协议，借助TCP传送

BGP支持CIDR

BGP-4的四种报文：1）打开（Open）报文：用于与相邻的另一个 BGP 发言人建立关系，并认证发送方。2）更新（Update）报文：通告新路径或撤销原路径。3）保活（Keepalive）报文：用来确认打开报文并周期性地证实邻站关系。4）通知（Notification）报文：用来发送检测到的差错。

<img src=".\picture\BGP发言人.png" alt="BGP发言人" style="zoom:67%;" />